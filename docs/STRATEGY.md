# 📊 매매 전략 상세 문서

## 사용 지표

| 지표 | 설정값 | 용도 |
|------|--------|------|
| EMA (지수이동평균) | 9, 21 | 추세 방향 + 골든/데드크로스 |
| RSI (상대강도지수) | 14 | 과매수/과매도 판단 |
| 볼린저 밴드 | 20, 2σ | 변동성 + 돌파 방향 |
| VWAP | 당일 | 평균가 대비 위치 판단 |
| 거래량 | 20봉 평균 대비 | 거래량 급증 감지 |

## 진입 조건 (매수, 5분봉 기준)

모든 조건 동시 충족 시 매수:

1. ✅ **EMA 9 > EMA 21** — 골든크로스 직후 또는 유지 중
2. ✅ **RSI(14) 30~70 구간** — 과열 아닌 상승 초입 (설정값 기반)
3. ✅ **현재가 > 볼린저밴드 중간선(SMA 20)** — 중심선 상회
4. ✅ **현재 거래량 > 20봉 평균 × 1.1배** — 거래량 급증 (설정값 기반)
5. ✅ **현재가 > VWAP** — 당일 평균가 상회 (활성화 시)
6. ✅ **1시간봉 EMA 9 > EMA 21** — 큰 추세 상승 확인

### 신호 점수 가중치 (Score 기반 진입)

| 조건 | 가중치 | 비고 |
|------|--------|------|
| ema_bullish | 25점 | 추세 핵심 |
| volume_surge | 20점 | 거래량 매우 중요 |
| rsi_in_range | 15점 | |
| above_bb_mid | 15점 | |
| above_vwap | 10점 | |
| trend_bullish | 15점 | 상위 타임프레임 (1h) |
| **합계** | **100점** | 70점(수정 가능) 이상만 진입 |

## 💰 포지션 사이징 (개선됨)

| 설정 항목 | 기준값 |
|-----------|--------|
| **티커당 마진 비중** | **총자산(Equity)의 3.0%** |
| **레버리지** | **10배 (격리 모드)** |
| **동적 사이징(ATR)** | 변동성(ATR%)에 따라 비중 조절 (Cap 4%) |
| **ATR 타겟** | 0.3% (기준점 대비 낮으면 증액, 높으면 감액) |
| **최대 동시 포지션** | 5개 |

## 🏁 청산 조건 (매도/종료)

### 🛑 손절 (Stop Loss)
1. **고정 손절**: 진입가 대비 **-1.0%** 도달 시 전량 청산
2. **동적 손절**: 최근 10캔들 저점(롱)/고점(숏) 이탈 시 청산 (단, 진입가 대비 **최대 2.0% 캡** 적용)
3. **지표 청산(EMA)**: EMA 데드크로스 발생 시, **미실현 손실 중인 경우에만** 즉시 청산
4. **시간 청산(60분)**: 60분 경과 시 **손실권이면 즉시 청산**, 수익권이면 트레일링 스탑 유지

### 🎯 익절 (Take Profit - 다단계)
- **TP1 (+0.8%)**: 보유 수량의 **30% 익절** → **트레일링 스탑 활성화**
- **TP2 (+1.5%)**: 보유 수량의 **30% 추가 익절** (누적 60%)
- **TP3 (+2.5%)**: 남은 **모든 수량 전량 익절**

### 📉 트레일링 스탑 (Trailing Stop)
- **활성화**: TP1 도달 시점부터 작동
- **작동**: 고점(롱) 또는 저점(숏) 대비 **0.4% 되돌림** 발생 시 남은 전량 즉시 익절

## 🛡️ 리스크 관리 (안전장치)

| 규칙 | 설정값 | 목적 |
|------|--------|------|
| **총 마진 사용 한도** | **총자산의 20% 이내** | 과도한 노출 방지 |
| **최소 가용 잔고** | **총자산의 50% 이상** | 유동성 확보 (증거금 보호) |
| **중복 진입 금지** | 동일 티커 1포지션 원칙 | 리스크 분산 |
| **연속 패배 중단** | 5연패 시 당일 거래 종료 | 뇌동매매 방지 |
| **일일 최대 손실** | 총자산의 7% 도달 시 정지 | 자본 보호 |
## ⛓️ 실행 무결성 (Execution Integrity)
매매 전략의 신뢰도를 보장하기 위해 본 봇은 다음과 같은 실행 원칙을 고수합니다.

- **Managed Only Accuracy**: 봇이 직접 진입 신호를 생성하고 디스코드에 공식적으로 통보한 포지션만 '승인된 포지션'으로 간주합니다.
- **Drift Protection (Sync Check)**: 거래소의 실제 체결 상태와 봇 내부 DB의 불일치(Drift)를 매 사이클마다 감시하며, 예외 상황(미관리 포지션 등) 발생 시 즉시 강제 보정(청산)을 수행합니다.
- **Pure DB Reporting**: 잔고 리포트는 거래소의 외부 노이즈를 배제하고, 오직 봇의 전략적 판단에 의한 자산 변동만을 추적하여 리포팅합니다.
